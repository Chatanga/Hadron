module Common.Random
    ( RandomState
    , runRandom
    , runRandomIO
    , getRandom
    , getRandomR
    , poissonOnSphere
    ) where

import Control.Applicative()
import Control.Monad.State
import Data.Functor

import System.Random

----------------------------------------------------------------------------------------------------

type RandomState a = State StdGen a

runRandom :: Int -> RandomState a -> a
runRandom n r = evalState r $ mkStdGen n

runRandom' :: Int -> RandomState a -> a
runRandom' _ r = evalState r $ mkStdGen 0

runRandomIO :: RandomState a -> IO a
runRandomIO r = randomIO <&> flip runRandom' r

getRandom :: Random a => RandomState a
getRandom = do
    (v, g) <- gets random
    put g
    return v

getRandomR :: Random a => (a, a) -> RandomState a
getRandomR (minValue, maxValue) = do
    (v, g) <- gets (randomR (minValue, maxValue))
    put g
    return v

-- Constant Poisson distribution of 128 points on the surface of a sphere.
-- (Thanks to https://github.com/bartwronski/PoissonSamplingGenerator)
poissonOnSphere :: [(Float, Float, Float)]
poissonOnSphere =
    [ (-0.3414558415883376, 0.47931929400763895, 0.014927246681158413)
    , (0.3920070246411152, -0.8571663101312946, -0.2978585547549185)
    , (0.8586727550369242, 0.01803265197686947, 0.4122421490811356)
    , (-0.15858010450323462, -0.01272773714198098, -0.9831068853902778)
    , (-0.1304722527859856, -0.41714175762933414, 0.7971033109431124)
    , (-0.770659076838579, -0.4110319208421246, -0.3807763766894435)
    , (0.6201262864126764, 0.31716598790313877, -0.36198922058842437)
    , (-0.8407341897698122, -0.13908896062176732, 0.49681010092572453)
    , (0.43896966540609905, 0.6371482196034117, 0.586364807723203)
    , (0.023309654610833022, 0.6335265082418075, -0.6977793722708764)
    , (-0.1437541269028701, -0.439170501080338, 0.011247763625703988)
    , (0.6209927268987278, -0.6240841077846047, 0.29851329530557813)
    , (-0.430277259801827, 0.3648339088129945, 0.7872855855472143)
    , (0.38951390033776145, -0.3877894447782661, -0.8282487618127831)
    , (-0.6406112879718492, 0.3929136214195048, -0.5571814668612405)
    , (0.25319241852478896, 0.12287521264091095, 0.14402852716842507)
    , (-0.211687005144547, -0.8101246877120659, -0.48259984227192004)
    , (0.28681738095950626, 0.7711596751776459, -0.04046286144866743)
    , (0.06863815921354198, -0.06340595514048156, -0.3760313747920816)
    , (0.12592381826784768, 0.1250992118353074, 0.7783521450901356)
    , (0.935876625275596, -0.2674721359864504, -0.118095006706662)
    , (-0.29283291514992, 0.0057389393445875245, 0.3808938564718199)
    , (-0.892552664796017, 0.38613214879360047, 0.1680329899948827)
    , (-0.574144920231802, -0.6716430205717087, 0.3972723312547948)
    , (0.5053721168405519, -0.31385331346324546, 0.7968252039266276)
    , (-0.1471531690110569, -0.9507176397551658, 0.04746203592699736)
    , (0.0054919522776415925, 0.7712973183894895, 0.4823029225659699)
    , (0.19721969068550463, -0.7502713095686177, 0.47234684190867626)
    , (-0.40729141736184005, -0.30332172624289133, -0.7157478266763284)
    , (-0.3288876693997163, 0.8715793160300866, -0.35864877985382015)
    , (0.3609798322633297, -0.25141156622034555, -0.08916912306981208)
    , (-0.6006770909440987, -0.17703288494874006, 0.044104326377480844)
    , (-0.551072692969986, -0.7404135119129039, -0.1567747156888309)
    , (-0.9069681300796563, 0.02563642360550646, -0.24931642378715507)
    , (0.882134483824423, 0.4016802151090088, 0.023602547758827107)
    , (0.6568095883903459, -0.15599680050833223, -0.4532185377729369)
    , (-0.2287792610943236, 0.21413992338805166, -0.5936601593303491)
    , (0.2797208355194406, 0.2685479490921377, -0.6396733315199017)
    , (-0.016009609123255428, -0.3095187586900899, 0.38348257728746876)
    , (-0.47440228768283166, -0.1420412449371291, 0.7014171834911267)
    , (0.05257589904927275, 0.43850220110678123, -0.2858155428320644)
    , (-0.579799758883089, 0.6499378480287886, 0.32103211462302583)
    , (-0.7008403725772621, 0.26514725611615936, 0.49733910178208873)
    , (0.5864029914021823, 0.5845975100446084, 0.21882478386987)
    , (0.006476215680495718, -0.41523876437349233, -0.6062633758964967)
    , (0.4883537664906119, 0.6600566521893626, -0.5113527196812011)
    , (-0.09300430351410383, 0.9799719010887974, 0.09979868984237034)
    , (-0.3204855744888311, 0.04894412888267011, -0.2039678825670452)
    , (-0.6919725536170886, -0.010410253689143377, -0.6562094550201654)
    , (0.6377525171034486, 0.30577010542580924, 0.6693732605817386)
    , (-0.11973768901938246, 0.40425744701962385, 0.3316963622643753)
    , (0.38656703306015966, -0.1563380079750537, 0.4091053496260737)
    , (-0.598244715845043, 0.18397304613556767, -0.01792330442006462)
    , (0.04848377584712411, 0.5175118387191364, 0.8231065623258372)
    , (0.7557222247163123, -0.5801979079329808, -0.2466863801340001)
    , (0.4356238257223782, -0.8546890806512182, 0.07915412014169347)
    , (0.1970304210015488, 0.5161005122526261, 0.18529269862751896)
    , (0.20553858741680983, -0.7111975943396097, -0.6223319891022971)
    , (0.37423000314805865, 0.34540224687262094, -0.11251306863900966)
    , (-0.8558840529008581, 0.3921637887883616, -0.22098826425159576)
    , (0.5932367455230075, 0.18262330975318583, 0.21450391195104804)
    , (-0.19366809605606614, -0.7495841004352435, 0.5864357008027755)
    , (0.03472716154984655, -0.5810124949782834, -0.2837013456946156)
    , (-0.7958083310482713, -0.47308618123690876, 0.012531494037149536)
    , (0.6363756988472042, 0.08502930799376997, -0.12245663871287046)
    , (0.18626330116035322, -0.5878795639454663, 0.04486771167185866)
    , (0.5079269823746865, 0.09593193902736634, -0.80559541341679)
    , (-0.955623122061061, -0.21194972506927887, 0.17387700043689505)
    , (-0.31435954236549224, 0.5585165413781785, -0.7011009563407693)
    , (0.07376584412520386, 0.9312869266086308, -0.3047463227009036)
    , (-0.42507925016895215, -0.36756593673612376, 0.4582401415030813)
    , (0.7726407367492326, -0.3441783232493642, 0.18404273152351264)
    , (0.38252734154514884, 0.19960460002655578, 0.4710528904789951)
    , (-0.5829910675146984, 0.736514570616698, -0.07738277589299705)
    , (-0.42059169885586933, -0.37819193559122566, -0.31922166313960126)
    , (0.6110582078618356, 0.02295196260280666, 0.5817647395941399)
    , (0.6391288685927246, 0.6529595269052847, -0.2047962852169872)
    , (0.1594636970403301, 0.015424575889418783, -0.8479281003584443)
    , (-0.048480427703040195, 0.20612250321473913, 0.027055713099431142)
    , (0.5694841978245323, 0.40893507273963325, -0.7039434914454064)
    , (0.8871051275037938, 0.0788420018508642, -0.3652413509286274)
    , (0.25668046955837487, -0.5534670579451819, 0.7509795619319944)
    , (-0.5094249432635102, 0.2231461819969964, -0.8122609400189158)
    , (0.43644363840062134, -0.465290906090432, -0.49225457833467223)
    , (-0.2684481293995816, 0.03554940197593229, 0.9399404323145504)
    , (-0.16770403274773546, 0.21074200931336765, 0.6229288269121874)
    , (0.1726793698604124, -0.2340713882537278, 0.8862210815784195)
    , (-0.2968838182651755, -0.634647169775247, 0.2769234561664763)
    , (-0.31275642405331866, 0.5511926876226503, 0.5641685430310046)
    , (-0.28590522297188625, 0.8315709189757401, 0.2939625647097295)
    , (-0.6358861215963635, -0.11728452832847873, -0.28837008001212283)
    , (0.28111427387429794, -0.44645046736859934, 0.27884538617589344)
    , (-0.1017256653151553, 0.325727895012339, -0.936392036088907)
    , (-0.15585927642152553, -0.1715181721109677, 0.1510454158357586)
    , (0.31621843216413437, 0.7910101806659628, 0.271101508393086)
    , (-0.5256539013413473, -0.669683108999095, -0.5225731294141417)
    , (-0.2848568108150286, 0.47814428933860037, -0.3839182366431161)
    , (0.35873624351970884, 0.042734035383629174, -0.3141424779238352)
    , (-0.1816559551825753, -0.21837320404717964, -0.3576881048750184)
    , (-0.023886927868525892, -0.05146348095096273, 0.5631240448258235)
    , (-0.5821034015855494, 0.07784780835929608, 0.27089433307407773)
    , (0.060059778084575084, -0.2800993281745917, -0.9540000405886309)
    , (0.15351505398463133, -0.17872534313972321, 0.18228075346447864)
    , (0.30091282216449233, -0.06844773391306197, -0.5935084672474242)
    , (-0.5667830502284422, 0.6460912875917415, -0.37442587314330683)
    , (-0.5153263725224233, 0.2829454413707337, -0.31987283995475346)
    , (-0.06964733842362295, 0.6032820356234153, 0.05449700711297902)
    , (-0.38556604768821784, 0.29248295065879887, 0.28657066685420607)
    , (0.05721072503567871, -0.9487586061389041, -0.30719946395288894)
    , (-0.17119001030240033, -0.6141624131793565, -0.6885662540207893)
    , (0.7238663638842514, -0.41175368036151644, 0.5197348504288792)
    , (0.1537097298129584, 0.38911147782549527, 0.5441090982795934)
    , (-0.7894460710136534, -0.454441716223835, 0.32921765001986525)
    , (0.8443534475218771, 0.32834895721535745, 0.37245375801401703)
    , (0.13879369266692185, -0.8832748927206305, -0.0024447778470523124)
    , (0.9821844739031276, 0.014612485730051658, 0.03157928258801027)
    , (0.4833306155655181, -0.022706917673133525, 0.8281472903242763)
    , (-0.022765497208789634, -0.13544090344996856, -0.10334976663498409)
    , (0.3733302836133405, 0.32641571912145806, 0.7888145108584974)
    , (0.21863966349522104, 0.6881925823768584, -0.33858936976889925)
    , (0.5285483975780101, -0.10263586501708684, 0.1263632153120363)
    , (-0.18664626334888906, -0.6917032287372072, -0.10141693430845433)
    , (0.6643285004935622, -0.719434475811779, -0.02545509728591362)
    , (-0.14189196112664731, -0.20826613299605845, -0.7387276880509889)
    , (-0.8552158270907935, -0.22676039996595682, -0.1728950591302401)
    , (-0.41083332877832834, -0.5561220976243265, 0.6829453042756641)
    , (-0.4010275618192451, -0.4855502097262222, -0.042237557213954)
    , (-0.07355407147591254, 0.6973969927323873, -0.40343789773103095)
    ]
